{"version":3,"sources":["config.ts","slices/artboard.ts","store.ts","components/Grid.tsx","components/Menu.tsx","components/Placement.tsx","components/DropShadow.tsx","components/Border.tsx","components/AppStage.tsx","components/Artboard.tsx","components/Selector.tsx","components/App.tsx","index.tsx"],"names":["FurnitureType","config","ppmArtboard","ppmSelector","width","height","gridStep","padding","furniture","file","size","type","Seat","code","price","name","parts","LeftCorner","RightCorner","Complex","offset","toPixel","x","map","furnitureConfig","image","Image","src","process","selectorWidth","selectorHeight","round","Math","artboard","slice","createSlice","initialState","placement","drop","id","visible","stageRect","y","magnets","reducers","place","state","action","payload","rotation","ox1","oy1","r","rect","push","selected","move","movementX","movementY","notCornerId","find","undefined","dx","dy","forEach","p","rotate","groupRect","gx","gy","gh","current","rx","ry","rh","rw","remove","console","log","filter","i","includes","setSelected","allIds","attached","id1","id2","crop","Util","haveIntersection","conflict","add","ids","xs","result","flatMap","Array","from","Set","length","setStageRect","setDrop","addMagnets","seat","removeMagnets","actions","selectFurniture","selectArtboard","selectPlacement","selectStageRect","selectDrop","t","possible","every","rect1","rect2","selectMagnets","artboardReducer","reducer","store","configureStore","useAppDispatch","useDispatch","useAppSelector","useSelector","Grid","lines","key","stroke","vertical","points","horizontal","rotateImage","document","createElement","deleteImage","Menu","onRotate","onDelete","Button","onClick","useState","hover","setHover","onMouseEnter","onMouseLeave","radius","strokeWidth","fill","Placement","rectMode","dispatch","start","setStart","grouped","xMin","Infinity","yMin","xMax","yMax","noCorner","getGroupRect","groupWidth","groupHeight","xRange","yRange","e","draggable","onDragStart","target","getClientRect","onDragEnd","dragBoundFunc","pos","toRange","min","max","DropShadow","dropRef","m","defaultProps","ref","l","opacity","closed","Border","AppStage","rectRef","useRef","x1","y1","x2","y2","setState","abs","onMouseDown","stage","KonvaStage","KonvaLine","getLayerXY","onMouseMove","onMouseUp","useStore","evt","clientX","clientY","currentTarget","attrs","container","getBoundingClientRect","Artboard","stageRef","typeSeatOrComplex","typeCorner","dispatchVisible","useEffect","Dropzone","onDragOver","preventDefault","dropImage","dropzone","Element","layerX","layerY","dropWidth","dropHeight","ox2","oy2","setAttrs","nearest","threshold","distances","distance","sqrt","nearestI","reduce","minI","value","getNearestMagnet","cos","SQRT2","sin","onDrop","onDragLeave","deg2rad","PI","styled","div","Selector","shift","chevrons","outerWrap","innerWidth","direction","outerWidth","displayed","floor","nextShift","handleDragStart","getAttribute","dataTransfer","setDragImage","emptyImage","setEmptyDragImage","handleDragEnd","Carousel","LeftChevron","alt","OuterWrap","InnerWrap","Figure","RightChevron","props","figure","App","ReactDOM","getElementById"],"mappings":"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","file":"static/js/main.fe437820.chunk.js","sourcesContent":["export enum FurnitureType {\n    Seat,\n    LeftCorner,\n    RightCorner,\n    Complex,\n}\n\ninterface FurnitureConfig {\n    file: string;\n    size: number[];\n    type: FurnitureType;\n    code: string;\n    price: number;\n    name: string;\n    parts: number[];\n    offset?: number[];\n}\n\nexport const config: {\n    ppmArtboard: number;\n    ppmSelector: number;\n    width: number;\n    height: number;\n    gridStep: number;\n    padding: number;\n    furniture: FurnitureConfig[];\n} = {\n    ppmArtboard: 100,\n    ppmSelector: 40,\n    width: 8.0,\n    height: 6.0,\n    gridStep: 0.2,\n    padding: 0.37,\n    furniture: [\n        {\n            file: \"BS1.png\",\n            size: [0.8, 0.8],\n            type: FurnitureType.Seat,\n            code: \"BS1-A\",\n            price: 799,\n            name: \"(0.8x0.8m)\",\n            parts: [0],\n        },\n        {\n            file: \"BS2.png\",\n            size: [1.6, 0.8],\n            type: FurnitureType.Seat,\n            code: \"BS2-A\",\n            price: 1329,\n            name: \"(1.6x0.8m)\",\n            parts: [1],\n        },\n        {\n            file: \"BS3.png\",\n            size: [2.4, 0.8],\n            type: FurnitureType.Seat,\n            code: \"BS3-A\",\n            price: 1869,\n            name: \"(2.4x0.8m)\",\n            parts: [2],\n        },\n        {\n            file: \"BA1.png\",\n            size: [0.93, 0.93],\n            type: FurnitureType.LeftCorner,\n            code: \"BA1-A\",\n            price: 899,\n            name: \"(0.8x0.8m)\",\n            parts: [3],\n        },\n        {\n            file: \"BA2-L.png\",\n            size: [1.76, 0.93],\n            type: FurnitureType.LeftCorner,\n            code: \"BA2L-A\",\n            price: 1269,\n            name: \"(1.6x0.8m)\",\n            parts: [4],\n        },\n        {\n            file: \"BA2-R.png\",\n            size: [1.76, 0.93],\n            type: FurnitureType.RightCorner,\n            code: \"BA2R-A\",\n            price: 1269,\n            name: \"(1.6x0.8m)\",\n            parts: [5],\n        },\n        {\n            file: \"BS1+BA1.png\",\n            size: [0.93, 0.93],\n            type: FurnitureType.Complex,\n            code: \"BS1+BA1\",\n            price: 1698,\n            name: \"(0.8x0.8m)\",\n            parts: [0, 3],\n            offset: [-0.1, -0.11, 0, 0],\n        },\n        {\n            file: \"BS2+BA1.png\",\n            size: [1.7, 0.93],\n            type: FurnitureType.Complex,\n            code: \"BS2+BA1\",\n            price: 2228,\n            name: \"(1.6x0.8m)\",\n            parts: [1, 3],\n            offset: [0, -0.13, -0.1, 0],\n        },\n        {\n            file: \"BS2+BA2L.png\",\n            size: [1.76, 0.93],\n            type: FurnitureType.Complex,\n            code: \"BS2+BA2L\",\n            price: 2598,\n            name: \"(1.6x0.8m)\",\n            parts: [1, 4],\n            offset: [-0.05, -0.13, -0.11, 0],\n        },\n        {\n            file: \"BS2+BA2R.png\",\n            size: [1.76, 0.93],\n            type: FurnitureType.Complex,\n            code: \"BS2+BA2R\",\n            price: 2598,\n            name: \"(1.6x0.8m)\",\n            parts: [1, 5],\n            offset: [-0.1, -0.13, -0.06, 0],\n        },\n        {\n            file: \"BS2+BA1+BA1.png\",\n            size: [1.86, 0.93],\n            type: FurnitureType.Complex,\n            code: \"BS2+BA1+BA1\",\n            price: 3127,\n            name: \"(1.6x0.8m)\",\n            parts: [1, 3, 3],\n            offset: [-0.12, -0.11, -0.14, -0.02],\n        },\n        {\n            file: \"BS2+BS2+BA2L.png\",\n            size: [2.55, 1.76],\n            type: FurnitureType.Complex,\n            code: \"BS2+BS2+BA2L\",\n            price: 3927,\n            name: \"(2.4x1.6m)\",\n            parts: [1, 1, 4],\n            offset: [0.01, -0.14, -0.16, -0.02],\n        },\n        {\n            file: \"BS2+BS2+BA2R.png\",\n            size: [2.55, 1.76],\n            type: FurnitureType.Complex,\n            code: \"BS2+BS2+BA2R\",\n            price: 3927,\n            name: \"(2.4x1.6m)\",\n            parts: [1, 1, 5],\n            offset: [-0.16, -0.15, 0, 0],\n        },\n        {\n            file: \"BS3+BA1.png\",\n            size: [2.55, 0.93],\n            type: FurnitureType.Complex,\n            code: \"BS3+BA1\",\n            price: 2768,\n            name: \"(2.4x0.8m)\",\n            parts: [2, 3],\n            offset: [-0.14, -0.12, 0, 0],\n        },\n        {\n            file: \"BS3+BA1+BA2R.png\",\n            size: [2.68, 0.93],\n            type: FurnitureType.Complex,\n            code: \"BS3+BA1+BA2R\",\n            price: 4037,\n            name: \"(2.4x0.8m)\",\n            parts: [2, 3, 5],\n            offset: [-0.14, -0.12, -0.14, 0],\n        },\n        {\n            file: \"BS3+BA1_flip.png\",\n            size: [2.55, 0.93],\n            type: FurnitureType.Complex,\n            code: \"BS3+BA1\",\n            price: 2768,\n            name: \"(2.4x0.8m)\",\n            parts: [2, 3],\n            offset: [0, -0.12, -0.15, 0],\n        },\n        {\n            file: \"BS3+BA2L.png\",\n            size: [2.55, 0.93],\n            type: FurnitureType.Complex,\n            code: \"BS3+BA2L\",\n            price: 3138,\n            name: \"(2.4x0.8m)\",\n            parts: [2, 4],\n            offset: [0, -0.12, -0.15, 0],\n        },\n        {\n            file: \"BS3+BA2R.png\",\n            size: [2.55, 0.93],\n            type: FurnitureType.Complex,\n            code: \"BS3+BA2R\",\n            price: 3138,\n            name: \"(2.4x0.8m)\",\n            parts: [2, 5],\n            offset: [-0.14, -0.12, 0, 0],\n        },\n    ],\n};\n","import { config } from \"../config\";\nimport { createSlice, PayloadAction, current } from \"@reduxjs/toolkit\";\nimport { RootState } from \"../store\";\nimport { IRect } from \"konva/lib/types\";\nimport { FurnitureType } from \"../config\";\nimport { Util } from \"konva/lib/Util\";\n\n// config to furniture\nconst toPixel = (x: number) => x * config.ppmArtboard;\nconst furniture = config.furniture.map((furnitureConfig) => {\n    const { size, file, offset } = furnitureConfig;\n    const width = toPixel(size[0]);\n    const height = toPixel(size[1]);\n    const image = new Image();\n    image.width = width;\n    image.height = height;\n    image.src = `${process.env.PUBLIC_URL}/images/${file}`;\n    return {\n        ...furnitureConfig,\n        image,\n        width,\n        height,\n        selectorWidth: size[0] * config.ppmSelector,\n        selectorHeight: size[1] * config.ppmSelector,\n        offset: (offset ?? [0, 0, 0, 0]).map(toPixel),\n    };\n});\n\n// config to artboard\nconst width = toPixel(config.width);\nconst height = toPixel(config.height);\nconst gridStep = toPixel(config.gridStep);\nconst padding = toPixel(config.padding);\nconst round = (x: number) => Math.round((x - padding) / gridStep) * gridStep + padding;\nconst artboard = { width, height, gridStep, padding, round };\n\n// slice\nexport interface Placement {\n    id: number;\n    x: number;\n    y: number;\n    rotation: number;\n    selected: boolean;\n    rect: IRect;\n    offset: number[];\n    type: FurnitureType;\n}\nexport interface Magnet {\n    x: number;\n    y: number;\n    rotation: number;\n}\nconst slice = createSlice({\n    name: \"artboard\",\n    initialState: {\n        placement: [] as Placement[],\n        drop: {\n            id: 0,\n            visible: false,\n            type: FurnitureType.Seat,\n        },\n        stageRect: { x: 0, y: 0, width: 0, height: 0 } as IRect,\n        magnets: [] as Magnet[],\n    },\n    reducers: {\n        place: (state, action: PayloadAction<{ id: number; x: number; y: number; rotation?: number }>) => {\n            const { id, x, y, rotation } = action.payload;\n            const { width, height, type, offset } = furniture[id];\n            const [ox1, oy1, ox2, oy2] = offset;\n            const r = ((rotation ?? 0) + 360) % 360;\n            const rect = { x: x - ox1, y: y - oy1, width: width + ox1 + ox2, height: height + oy1 + oy2 };\n            if (r === 90) {\n                rect.x -= height;\n                rect.width += height - width;\n                rect.height += width - height;\n            } else if (r === 180) {\n                rect.y -= height;\n                rect.x -= width;\n            } else if (r === 270) {\n                rect.y -= width;\n                rect.width += height - width;\n                rect.height += width - height;\n            }\n            state.placement.push({\n                id,\n                x: x - ox1,\n                y: y - oy1,\n                rotation: r,\n                selected: false,\n                rect,\n                offset,\n                type,\n            });\n        },\n        move: (state, action: PayloadAction<{ selected: number[]; movementX: number; movementY: number }>) => {\n            const { placement } = state;\n            const { selected, movementX, movementY } = action.payload;\n            const notCornerId = selected.find((id) => {\n                const type = placement[id].type;\n                return type === FurnitureType.Seat || type === FurnitureType.Complex;\n            });\n            if (notCornerId === undefined) return state;\n            const { x, y } = placement[notCornerId].rect;\n            const dx = round(x + movementX) - x;\n            const dy = round(y + movementY) - y;\n            selected.forEach((id) => {\n                const p = placement[id];\n                p.x += dx;\n                p.y += dy;\n                p.rect.x += dx;\n                p.rect.y += dy;\n            });\n        },\n        rotate: (\n            state,\n            action: PayloadAction<{ selected: number[]; groupRect: { x: number; y: number; height: number } }>\n        ) => {\n            const { placement } = state;\n            const { selected, groupRect } = action.payload;\n            const { x: gx, y: gy, height: gh } = groupRect;\n            selected.forEach((id) => {\n                const p = placement[id];\n                const {\n                    rotation,\n                    rect,\n                    offset: [ox1, oy1],\n                } = current(p);\n                const { x: rx, y: ry, height: rh, width: rw } = rect;\n                const dx = gx + gy + gh - rx - ry - rh;\n                const dy = -gx + gy + rx - ry;\n                p.rect.x += dx;\n                p.rect.y += dy;\n                p.rect.height = rw;\n                p.rect.width = rh;\n                p.rotation = (p.rotation + 90) % 360;\n                if (rotation === 0) {\n                    p.x = p.rect.x + rh - ox1 - oy1;\n                    p.y = p.rect.y - oy1 + ox1;\n                } else if (rotation === 90) {\n                    p.x = p.rect.x + rh - ox1 - ox1;\n                    p.y = p.rect.y + rw - oy1 - oy1;\n                } else if (rotation === 180) {\n                    p.x = p.rect.x - ox1 + oy1;\n                    p.y = p.rect.y + rw - oy1 - ox1;\n                } else {\n                    p.x = p.rect.x;\n                    p.y = p.rect.y;\n                }\n            });\n        },\n        remove: (state, action: PayloadAction<{ selected: number[] }>) => {\n            const { selected } = action.payload;\n            console.log(selected);\n            console.log(current(state.placement));\n            state.placement = state.placement.filter((p, i) => !selected.includes(i));\n        },\n        setSelected: (state, action: PayloadAction<number[]>) => {\n            const placement = current(state.placement);\n            const allIds = placement.map((p, i) => i);\n            const conflict = (id1: number, id2: number) => {\n                const t = 4;\n                const crop = ({ x, y, width, height }: IRect) => ({\n                    x: x + t,\n                    y: y + t,\n                    width: width - 2 * t,\n                    height: height - 2 * t,\n                });\n                return Util.haveIntersection(crop(placement[id1].rect), crop(placement[id2].rect));\n            };\n            const attached = (id1: number) => allIds.filter((id2) => conflict(id1, id2));\n            const unique = (xs: number[]) => Array.from(new Set(xs));\n            const add = (ids: number[]): number[] => {\n                const result = unique(ids.flatMap(attached));\n                return result.length === ids.length ? result : add(result);\n            };\n            const selected = add(action.payload);\n            for (let id = 0; id < placement.length; id++) {\n                state.placement[id].selected = selected.includes(id);\n            }\n        },\n        setStageRect: (state, action: PayloadAction<IRect>) => {\n            state.stageRect = action.payload;\n        },\n        setDrop: (state, action: PayloadAction<{ id?: number; visible?: boolean }>) => {\n            const { id, visible } = action.payload;\n            if (id !== undefined) {\n                state.drop.id = id;\n                state.drop.type = furniture[id].type;\n            }\n            if (visible !== undefined) state.drop.visible = visible;\n        },\n        addMagnets: (state) => {\n            const seats = state.placement.filter((p) => p.type === FurnitureType.Seat);\n            seats.forEach((seat) => {\n                const { x, y, width, height } = seat.rect;\n                state.magnets.push(\n                    { x, y, rotation: 0 },\n                    { x: x + width, y, rotation: 90 },\n                    { x: x + width, y: y + height, rotation: 180 },\n                    { x, y: y + height, rotation: 270 }\n                );\n            });\n        },\n        removeMagnets: (state) => {\n            state.magnets = [];\n        },\n    },\n});\n\n// actions\nexport const { place, move, rotate, remove, setSelected, setStageRect, setDrop, addMagnets, removeMagnets } =\n    slice.actions;\n// selectors\nexport const selectFurniture = (state: RootState) => furniture;\nexport const selectArtboard = (state: RootState) => artboard;\nexport const selectPlacement = (state: RootState) => state.artboard.placement;\nexport const selectStageRect = (state: RootState) => state.artboard.stageRect;\nexport const selectDrop = (state: RootState) => {\n    const crop = ({ x, y, width, height }: IRect, t = 4) => ({\n        x: x + t,\n        y: y + t,\n        width: width - 2 * t,\n        height: height - 2 * t,\n    });\n    const { placement, drop } = state.artboard;\n    const conflict = (rect1: IRect, rect2: IRect) => Util.haveIntersection(crop(rect1), crop(rect2));\n    const { width, height } = furniture[drop.id];\n    const possible = (x: number, y: number) => placement.every((p) => !conflict(p.rect, { x, y, width, height }));\n    return { ...state.artboard.drop, possible };\n};\nexport const selectMagnets = (state: RootState) => state.artboard.magnets;\n// reducer\nexport const artboardReducer = slice.reducer;\n","import { TypedUseSelectorHook, useDispatch, useSelector } from \"react-redux\";\nimport { configureStore } from \"@reduxjs/toolkit\";\nimport { artboardReducer } from \"./slices/artboard\";\n\nexport const store = configureStore({\n    reducer: {\n        artboard: artboardReducer,\n    },\n});\n\nexport type AppDispatch = typeof store.dispatch;\nexport type RootState = ReturnType<typeof store.getState>;\nexport const useAppDispatch = () => useDispatch<AppDispatch>();\nexport const useAppSelector: TypedUseSelectorHook<RootState> = useSelector;\n","import { LineConfig } from \"konva/lib/shapes/Line\";\nimport { Line } from \"react-konva\";\nimport { selectArtboard } from \"../slices/artboard\";\nimport { useAppSelector } from \"../store\";\n\nconst darkGrey = \"#999999\";\nconst lightGrey = \"#cccccc\";\n\nexport function Grid() {\n    const { width, height, gridStep, padding: p } = useAppSelector(selectArtboard);\n    const lines: LineConfig[] = [];\n    let key = 0;\n    let stroke = lightGrey;\n    const vertical = (x: number) => <Line key={key} stroke={stroke} x={x} y={p} points={[0, -1, 0, height + 1]} />;\n    const horizontal = (y: number) => <Line key={key} stroke={stroke} x={p} y={y} points={[-1, 0, width + 1, 0]} />;\n    for (let x = p; x <= width + p; key += 1, x += gridStep) lines.push(vertical(x));\n    for (let y = p; y <= height + p; key += 1, y += gridStep) lines.push(horizontal(y));\n    stroke = darkGrey;\n    for (let x = p; x <= width + p; key += 1, x += gridStep * 5) lines.push(vertical(x));\n    for (let y = p; y <= height + p; key += 1, y += gridStep * 5) lines.push(horizontal(y));\n    return <>{lines}</>;\n}\n","import { useState } from \"react\";\nimport { Circle, Group, Image } from \"react-konva\";\n\nconst size = 30;\nconst rotateImage = document.createElement(\"img\");\nrotateImage.src = `${process.env.PUBLIC_URL}/images/icons/rotate.svg`;\nconst deleteImage = document.createElement(\"img\");\ndeleteImage.src = `${process.env.PUBLIC_URL}/images/icons/delete.svg`;\n\nexport function Menu({\n    x,\n    y,\n    onRotate,\n    onDelete,\n}: {\n    x: number;\n    y: number;\n    onRotate: () => void;\n    onDelete: () => void;\n}) {\n    return (\n        <>\n            <Button x={x} y={y} image={rotateImage} onClick={onRotate} />\n            <Button x={x} y={y + size * 1.5} image={deleteImage} onClick={onDelete} />\n        </>\n    );\n}\n\nfunction Button({ x, y, image, onClick }: { x: number; y: number; image: HTMLImageElement; onClick: () => void }) {\n    const [hover, setHover] = useState(false);\n    return (\n        <Group onClick={onClick} onMouseEnter={() => setHover(true)} onMouseLeave={() => setHover(false)}>\n            <Circle\n                x={x - (size * 3) / 4}\n                y={y + size / 2}\n                radius={size / 2}\n                stroke={hover ? \"#f5f5f5\" : \"black\"}\n                strokeWidth={1}\n                fill={hover ? \"#f5f5f5\" : \"white\"}\n            />\n            <Image x={x - size * 1.15} y={y + size * 0.1} image={image} width={size * 0.8} height={size * 0.8} />\n        </Group>\n    );\n}\n","import {\n    move,\n    rotate,\n    remove,\n    setSelected,\n    selectPlacement,\n    selectFurniture,\n    selectStageRect,\n    selectArtboard,\n} from \"../slices/artboard\";\nimport { Group, Image, Rect } from \"react-konva\";\nimport { KonvaEventObject } from \"konva/lib/Node\";\nimport { useAppSelector } from \"../store\";\nimport { useDispatch } from \"react-redux\";\nimport { useState } from \"react\";\nimport { Vector2d } from \"konva/lib/types\";\nimport { Menu } from \"./Menu\";\nimport { Placement as PlacementType } from \"../slices/artboard\";\nimport { FurnitureType } from \"../config\";\n\ntype KEO = KonvaEventObject<globalThis.DragEvent>;\n\nexport function Placement({ rectMode }: { rectMode: boolean }) {\n    const dispatch = useDispatch();\n    const { padding, round } = useAppSelector(selectArtboard);\n    const furniture = useAppSelector(selectFurniture);\n    const placement = useAppSelector(selectPlacement);\n    const stageRect = useAppSelector(selectStageRect);\n    const [start, setStart] = useState({ x: 0, y: 0 });\n    const grouped = placement.filter((p) => p.selected);\n    const selected: number[] = [];\n    placement.forEach((p, i) => {\n        if (p.selected) selected.push(i);\n    });\n    const groupRect = getGroupRect(grouped, round);\n    const groupWidth = groupRect.width;\n    const groupHeight = groupRect.height;\n    const xRange = [\n        stageRect.x + padding - groupRect.x,\n        stageRect.x + stageRect.width - groupWidth - padding - groupRect.x,\n    ];\n    const yRange = [padding - groupRect.y, stageRect.height - groupHeight - padding - groupRect.y];\n    const dragBoundFunc = (pos: Vector2d) => {\n        return {\n            x: toRange(pos.x, xRange),\n            y: toRange(pos.y, yRange),\n        };\n    };\n    const onDragStart = (e: KEO) => {\n        const { x, y } = e.target.getClientRect();\n        setStart({ x, y });\n    };\n    const onDragEnd = (e: KEO) => {\n        const { x, y } = e.target.getClientRect();\n        dispatch(move({ selected, movementX: x - start.x, movementY: y - start.y }));\n        dispatch(setSelected([]));\n        dispatch(setSelected(selected));\n    };\n    const onRotate = () => {\n        dispatch(rotate({ selected, groupRect }));\n    };\n    const onDelete = () => {\n        dispatch(remove({ selected }));\n    };\n    const onMouseEnter = (id: number) => (e: KEO) => {\n        if (rectMode) return;\n        dispatch(setSelected([id]));\n    };\n    return (\n        <>\n            {/* {placement.map(({ rect: { x, y, width, height } }, key) => {\n                return <Rect stroke=\"cyan\" {...{ x, y, width, height, key }} />;\n            })} */}\n            {placement.map(({ id, x, y, rotation, selected }, key) => {\n                if (selected && !rectMode) return null;\n                const offset = furniture[id].offset;\n                return (\n                    <Image\n                        {...{ key, x: x + offset[0], y: y + offset[1], rotation }}\n                        image={furniture[id].image}\n                        onMouseEnter={onMouseEnter(key)}\n                    />\n                );\n            })}\n            {grouped.length > 0 && !rectMode && (\n                <Group draggable {...{ onDragStart, onDragEnd, dragBoundFunc }}>\n                    {grouped.map(({ id, x, y, rotation }, key) => {\n                        const offset = furniture[id].offset;\n                        return (\n                            <Image\n                                {...{ key, x: x + offset[0], y: y + offset[1], rotation }}\n                                image={furniture[id].image}\n                            />\n                        );\n                    })}\n                    {groupRect.visible && <Rect {...groupRect} stroke=\"black\" />}\n                    <Menu x={groupRect.x} y={groupRect.y} onRotate={onRotate} onDelete={onDelete} />\n                </Group>\n            )}\n        </>\n    );\n}\n\nfunction toRange(x: number, [min, max]: number[]) {\n    if (x < min) return min;\n    if (x > max) return max;\n    return x;\n}\n\nfunction getGroupRect(grouped: PlacementType[], round: (x: number) => number) {\n    let xMin = Infinity;\n    let yMin = Infinity;\n    let xMax = -Infinity;\n    let yMax = -Infinity;\n    const noCorner = (p: PlacementType) => p.type === FurnitureType.Seat || p.type === FurnitureType.Complex;\n    for (const p of grouped.filter(noCorner)) {\n        const { x, y, width, height } = p.rect;\n        if (x < xMin) xMin = x;\n        if (y < yMin) yMin = y;\n        if (x + width > xMax) xMax = x + width;\n        if (y + height > yMax) yMax = y + height;\n    }\n    const x = round(xMin);\n    const y = round(yMin);\n    return {\n        x,\n        y,\n        width: round(xMax) - x,\n        height: round(yMax) - y,\n        visible: grouped.length > 0,\n    };\n}\n","import { Image as KonvaImage } from \"konva/lib/shapes/Image\";\nimport { Image, Line } from \"react-konva\";\nimport { useAppSelector } from \"../store\";\nimport { selectFurniture, selectDrop, selectMagnets } from \"../slices/artboard\";\n\nexport function DropShadow({ dropRef }: { dropRef: React.RefObject<KonvaImage> }) {\n    const { id, visible } = useAppSelector(selectDrop);\n    const furniture = useAppSelector(selectFurniture);\n    const magnets = useAppSelector(selectMagnets);\n    if (!visible) return null;\n    const image = furniture[id].image;\n    return (\n        <>\n            {magnets.map((m, key) => (\n                <Line {...defaultProps} {...m} key={key} />\n            ))}\n            <Image ref={dropRef} y={-200} image={image} />\n        </>\n    );\n}\n\nconst l = 36;\nconst defaultProps = {\n    points: [0, 0, l, 0, l, l / 2, l * 0.5, l / 2, l * 0.5, l, 0, l],\n    fill: \"#00FF00\",\n    opacity: 0.5,\n    strokeWidth: 0,\n    closed: true,\n};\n","import { Line } from \"react-konva\";\nimport { selectArtboard, selectDrop } from \"../slices/artboard\";\nimport { useAppSelector } from \"../store\";\n\nexport function Border() {\n    const drop = useAppSelector(selectDrop);\n    const { width, height, padding: p } = useAppSelector(selectArtboard);\n    if (!drop.visible) return null;\n    return (\n        <>\n            <Line x={p} y={p} stroke=\"black\" points={[0, -1, 0, height + 1]} />\n            <Line x={p} y={p} stroke=\"black\" points={[-1, 0, width, 0]} />\n            <Line x={p} y={p + height} stroke=\"black\" points={[-1, 0, width, 0]} />\n            <Line x={p + width} y={p} stroke=\"black\" points={[0, -1, 0, height + 1]} />\n        </>\n    );\n}\n","import { useRef, useState } from \"react\";\nimport { Stage, Layer, Rect } from \"react-konva\";\nimport { Provider, useStore } from \"react-redux\";\nimport { Grid } from \"./Grid\";\nimport { Placement } from \"./Placement\";\nimport { DropShadow } from \"./DropShadow\";\nimport { Border } from \"./Border\";\nimport { Util } from \"konva/lib/Util\";\nimport { Image as KonvaImage } from \"konva/lib/shapes/Image\";\nimport { Rect as KonvaRect } from \"konva/lib/shapes/Rect\";\nimport { Line as KonvaLine } from \"konva/lib/shapes/Line\";\nimport { Stage as KonvaStage } from \"konva/lib/Stage\";\nimport { KonvaEventObject } from \"konva/lib/Node\";\nimport { useAppDispatch, useAppSelector } from \"../store\";\nimport { selectArtboard, selectPlacement, setSelected } from \"../slices/artboard\";\n\nexport function AppStage({ dropRef }: { dropRef: React.RefObject<KonvaImage> }) {\n    const dispatch = useAppDispatch();\n    const rectRef = useRef<KonvaRect>(null);\n    const placement = useAppSelector(selectPlacement);\n    const initialState = { x1: 0, y1: 0, x2: 0, y2: 0, rectMode: false };\n    const [{ x1, y1, x2, y2, rectMode }, setState] = useState(initialState);\n    const rect = { x: Math.min(x1, x2), y: Math.min(y1, y2), width: Math.abs(x2 - x1), height: Math.abs(y2 - y1) };\n    const { width, height, padding } = useAppSelector(selectArtboard);\n    const onMouseDown = (e: KonvaEventObject<MouseEvent>) => {\n        const stage = e.target;\n        if (!(stage instanceof KonvaStage || stage instanceof KonvaLine)) return;\n        const { x, y } = getLayerXY(e);\n        setState({ x1: x, y1: y, x2: x, y2: y, rectMode: true });\n        dispatch(setSelected([]));\n    };\n    const onMouseMove = (e: KonvaEventObject<MouseEvent>) => {\n        if (!rectMode) return;\n        const { x, y } = getLayerXY(e);\n        setState({ x1, y1, x2: x, y2: y, rectMode: true });\n    };\n    const onMouseUp = (e: KonvaEventObject<MouseEvent>) => {\n        if (!rectMode) return;\n        const selected: number[] = [];\n        placement.forEach((p, i) => {\n            if (Util.haveIntersection(rect, p.rect)) selected.push(i);\n        });\n        dispatch(setSelected(selected));\n        setState(initialState);\n    };\n\n    return (\n        <Stage {...{ onMouseDown, onMouseMove, onMouseUp }} width={width + 2 * padding} height={height + 2 * padding}>\n            <Provider store={useStore()}>\n                <Layer>\n                    <Grid />\n                    <Border />\n                    <Placement rectMode={rectMode} />\n                    <DropShadow dropRef={dropRef} />\n                    <Rect {...rect} ref={rectRef} fill=\"rgba(0,0,255,0.5)\" visible={rectMode} />\n                </Layer>\n            </Provider>\n        </Stage>\n    );\n}\n\nfunction getLayerXY(e: KonvaEventObject<MouseEvent>) {\n    const { clientX, clientY } = e.evt;\n    const { x, y } = e.currentTarget.attrs.container.getBoundingClientRect();\n    return {\n        x: clientX - x,\n        y: clientY - y,\n    };\n}\n","import { Image as KonvaImage } from \"konva/lib/shapes/Image\";\nimport { useAppDispatch, useAppSelector } from \"../store\";\nimport {\n    place,\n    setDrop,\n    selectArtboard,\n    selectFurniture,\n    selectDrop,\n    setStageRect,\n    selectStageRect,\n    selectMagnets,\n    Magnet,\n} from \"../slices/artboard\";\nimport { DragEventHandler, useEffect, useRef } from \"react\";\nimport styled from \"styled-components\";\nimport { AppStage } from \"./AppStage\";\nimport { FurnitureType } from \"../config\";\n\nexport function Artboard() {\n    const dispatch = useAppDispatch();\n    const { round, padding } = useAppSelector(selectArtboard);\n    const stageRef = useRef<HTMLDivElement>(null);\n    const stageRect = useAppSelector(selectStageRect);\n    const drop = useAppSelector(selectDrop);\n    const { type } = drop;\n    const typeSeatOrComplex = type === FurnitureType.Seat || type === FurnitureType.Complex;\n    const typeCorner = type === FurnitureType.LeftCorner || type === FurnitureType.RightCorner;\n    const furniture = useAppSelector(selectFurniture);\n    const dropRef = useRef<KonvaImage>(null);\n    const magnets = useAppSelector(selectMagnets);\n    const dispatchVisible = (visible: boolean) => {\n        if (drop.visible !== visible) dispatch(setDrop({ visible }));\n    };\n    useEffect(() => {\n        if (stageRef.current === null) return;\n        const { x, y, width, height } = stageRef.current.getBoundingClientRect();\n        if (stageRect.x === x && stageRect.width === width) return;\n        dispatch(setStageRect({ x, y, width, height }));\n    });\n    const onDragOver: DragEventHandler = (e) => {\n        e.preventDefault();\n        const dropImage = dropRef.current;\n        const dropzone = e.target;\n        if (dropImage === null || !(dropzone instanceof Element)) {\n            dispatchVisible(true);\n            return;\n        }\n        const { x, y, width, height } = dropzone.getBoundingClientRect();\n        const layerX = e.clientX - x;\n        const layerY = e.clientY - y;\n        const dropWidth = furniture[drop.id].width;\n        const dropHeight = furniture[drop.id].height;\n        if (typeSeatOrComplex) {\n            const { offset } = furniture[drop.id];\n            const [ox1, oy1, ox2, oy2] = offset;\n            // mutate ref object\n            const x = round(toRange(layerX, [padding, width - padding - dropWidth - ox1 - ox2])) + ox1;\n            const y = round(toRange(layerY, [padding, height - padding - dropHeight - oy1 - oy2])) + oy1;\n            dropImage.setAttrs({\n                x,\n                y,\n                visible: true,\n                opacity: 0.7,\n                fill: drop.possible(x, y) ? undefined : \"rgb(255,0,0,0.5)\",\n            });\n            return;\n        }\n        const nearest = getNearestMagnet(layerX, layerY, magnets);\n        if (nearest === undefined) {\n            // mutate ref object\n            dropImage.setAttrs({ visible: false });\n            return;\n        }\n        if (type === FurnitureType.LeftCorner) {\n            const { x, y, rotation } = nearest;\n            // mutate ref object\n            dropImage.setAttrs({\n                x: x + cos(rotation - 135) * 12 * Math.SQRT2,\n                y: y + sin(rotation - 135) * 12 * Math.SQRT2,\n                visible: true,\n                rotation,\n            });\n            return;\n        }\n        if (type === FurnitureType.RightCorner) {\n            const { x, y, rotation } = nearest;\n            // mutate ref object\n            dropImage.setAttrs({\n                x: x + cos(rotation - 135) * 12 * Math.SQRT2 + sin(-rotation) * dropWidth,\n                y: y + sin(rotation - 135) * 12 * Math.SQRT2 + cos(-rotation) * dropWidth,\n                visible: true,\n                rotation: rotation - 90,\n            });\n            return;\n        }\n    };\n    const onDragLeave: DragEventHandler = (e) => {\n        dispatchVisible(false);\n    };\n    const onDrop: DragEventHandler = (e) => {\n        e.preventDefault();\n        const dropImage = dropRef.current;\n        if (dropImage === null) return;\n        const { x, y, rotation, visible } = dropImage.attrs;\n        if ((typeSeatOrComplex && drop.possible(x, y)) || (typeCorner && visible)) {\n            dispatch(place({ id: drop.id, x, y, rotation }));\n        }\n    };\n    return (\n        <Dropzone ref={stageRef} onDragOver={onDragOver} onDrop={onDrop} onDragLeave={onDragLeave}>\n            <AppStage dropRef={dropRef} />\n        </Dropzone>\n    );\n}\n\nfunction toRange(x: number, [min, max]: number[]) {\n    if (x < min) return min;\n    if (x > max) return max;\n    return x;\n}\n\nconst deg2rad = Math.PI / 180;\n\nfunction cos(x: number) {\n    return Math.cos(x * deg2rad);\n}\n\nfunction sin(x: number) {\n    return Math.sin(x * deg2rad);\n}\n\nfunction getNearestMagnet(layerX: number, layerY: number, magnets: Magnet[]): Magnet | undefined {\n    const threshold = 100;\n    const distances = magnets.map((m) => {\n        const dx = layerX - m.x;\n        const dy = layerY - m.y;\n        const distance = Math.sqrt(dx * dx + dy * dy);\n        return distance < threshold ? distance : Infinity;\n    });\n    const nearestI = distances.reduce((minI, value, i): number => (distances[minI] > value ? i : minI), 0);\n    return distances[nearestI] === Infinity ? undefined : magnets[nearestI];\n}\nconst Dropzone = styled.div`\n    display: table;\n`;\n","import { useState, useRef, DragEventHandler, DragEvent } from \"react\";\nimport styled from \"styled-components\";\nimport { useAppDispatch, useAppSelector } from \"../store\";\nimport { selectFurniture, setDrop, addMagnets, removeMagnets, setSelected } from \"../slices/artboard\";\nimport { FurnitureType } from \"../config\";\n\nexport function Selector() {\n    // state\n    const [state, setState] = useState({\n        shift: 0,\n        chevrons: [false, true],\n    });\n    const size = 143;\n    const furniture = useAppSelector(selectFurniture);\n    const outerWrap = useRef<HTMLDivElement>(null);\n    const innerWidth = size * furniture.length;\n\n    // events\n    const dispatch = useAppDispatch();\n    const move = (direction: number) => {\n        if (null === outerWrap.current) return;\n        const outerWidth = outerWrap.current.getBoundingClientRect().width;\n        const displayed = Math.floor(outerWidth / size);\n        const min = -innerWidth + displayed * size;\n        let nextShift = state.shift + displayed * size * direction;\n        if (nextShift > 0) nextShift = 0;\n        if (nextShift < min) nextShift = min;\n        setState({ shift: nextShift, chevrons: [nextShift !== 0, nextShift !== min] });\n    };\n    const handleDragStart: DragEventHandler = (e) => {\n        const { target } = e;\n        if (!(target instanceof Element)) return;\n        const id = target.getAttribute(\"data-furniture-id\");\n        if (id === null) return;\n        setEmptyDragImage(e);\n        dispatch(setDrop({ id: +id }));\n        dispatch(setSelected([]));\n        const type = furniture[+id].type;\n        if (type === FurnitureType.LeftCorner || type === FurnitureType.RightCorner) {\n            dispatch(addMagnets());\n        }\n    };\n    const handleDragEnd: DragEventHandler = (e) => {\n        dispatch(setDrop({ visible: false }));\n        dispatch(removeMagnets());\n    };\n    return (\n        <Carousel>\n            <LeftChevron visible={state.chevrons[0]}>\n                <img src={`${process.env.PUBLIC_URL}/images/icons/arrow.svg`} alt=\"left\" onClick={() => move(1)} />\n            </LeftChevron>\n            <OuterWrap ref={outerWrap}>\n                <InnerWrap width={innerWidth} shift={state.shift}>\n                    {furniture.map(({ file, name, code, price, selectorWidth }, i) => (\n                        <Figure\n                            key={i}\n                            draggable=\"true\"\n                            onDragStart={handleDragStart}\n                            onDragEnd={handleDragEnd}\n                            data-furniture-id={i}\n                        >\n                            <img src={`${process.env.PUBLIC_URL}/images/${file}`} alt={name} width={selectorWidth} data-furniture-id={i} />\n                            <figcaption>\n                                {name} <br /> {code} <br /> {price} EUR{\" \"}\n                            </figcaption>\n                        </Figure>\n                    ))}\n                </InnerWrap>\n            </OuterWrap>\n            <RightChevron visible={state.chevrons[1]}>\n                <img src={`${process.env.PUBLIC_URL}/images/icons/arrow.svg`} alt=\"right\" onClick={() => move(-1)} />\n            </RightChevron>\n        </Carousel>\n    );\n}\n\nconst emptyImage = new Image();\nemptyImage.src = \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\";\nfunction setEmptyDragImage(e: DragEvent) {\n    e.dataTransfer.setDragImage(emptyImage, 0, 0);\n}\n\nconst Carousel = styled.div`\n    display: flex;\n`;\n\nconst LeftChevron = styled.div<{ visible: boolean }>`\n    transform: rotate(180deg);\n    align-self: center;\n    opacity: ${(props) => (props.visible ? 1 : 0)};\n`;\n\nconst RightChevron = styled(LeftChevron)`\n    transform: none;\n`;\n\nconst OuterWrap = styled.div`\n    margin: 0 5px;\n    overflow: hidden;\n`;\n\nconst InnerWrap = styled.div<{ width: number; shift: number }>`\n    transition: transform 1s;\n    margin: 20px -15px;\n    width: ${(props) => props.width}px;\n    transform: translateX(${(props) => props.shift}px);\n`;\n\nconst Figure = styled.figure`\n    display: block;\n    position: relative;\n    width: 113px;\n    height: 141px;\n    float: left;\n    margin: 0 15px;\n    text-align: center;\n    background-color: #f7f7f7;\n    text-align: left;\n    figcaption {\n        position: absolute;\n        font: 12px AtlasGrotesk-Regular;\n        left: 2px;\n        bottom: 3px;\n    }\n`;\n","import { Artboard } from \"./Artboard\";\nimport { Selector } from \"./Selector\";\n\nexport function App() {\n    return (\n        <>\n            <Selector />\n            <Artboard />\n        </>\n    );\n}\n","import * as React from \"react\";\nimport * as ReactDOM from \"react-dom\";\nimport { App } from \"./components/App\";\nimport { store } from \"./store\";\nimport { Provider } from \"react-redux\";\nimport \"./index.css\";\n\nReactDOM.render(\n    <React.StrictMode>\n        <Provider store={store}>\n            <App />\n        </Provider>\n    </React.StrictMode>,\n    document.getElementById(\"root\")\n);\n"],"sourceRoot":""}