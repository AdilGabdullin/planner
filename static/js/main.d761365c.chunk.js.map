{"version":3,"sources":["config.ts","slices/artboard.ts","store.ts","components/Grid.tsx","components/Menu.tsx","components/Placement.tsx","components/DropShadow.tsx","components/Border.tsx","components/AppStage.tsx","components/Artboard.tsx","components/Selector.tsx","components/App.tsx","index.tsx"],"names":["FurnitureType","config","ppmArtboard","ppmSelector","width","height","gridStep","padding","furniture","file","size","type","Seat","code","price","name","parts","LeftCorner","RightCorner","Complex","offset","toPixel","x","map","furnitureConfig","image","Image","src","process","selectorWidth","selectorHeight","round","Math","artboard","slice","createSlice","initialState","placement","drop","id","visible","stageRect","y","magnets","reducers","place","state","action","payload","rotation","ox1","oy1","r","rect","push","selected","move","movementX","movementY","notCornerId","find","undefined","dx","dy","forEach","p","rotate","groupRect","gx","gy","gh","current","rx","ry","rh","rw","setSelected","allIds","i","attached","id1","filter","id2","crop","Util","haveIntersection","conflict","add","ids","xs","result","flatMap","Array","from","Set","length","includes","setStageRect","setDrop","addMagnets","seat","removeMagnets","actions","selectFurniture","selectArtboard","selectPlacement","selectStageRect","selectDrop","t","possible","every","rect1","rect2","selectMagnets","artboardReducer","reducer","store","configureStore","useAppDispatch","useDispatch","useAppSelector","useSelector","Grid","lines","key","stroke","vertical","points","horizontal","rotationIcon","document","createElement","Menu","onRotate","useState","hover","setState","onClick","onMouseEnter","onMouseLeave","radius","strokeWidth","fill","Placement","rectMode","dispatch","start","setStart","grouped","xMin","Infinity","yMin","xMax","yMax","noCorner","getGroupRect","groupWidth","groupHeight","xRange","yRange","e","draggable","onDragStart","target","getClientRect","onDragEnd","dragBoundFunc","pos","toRange","min","max","DropShadow","dropRef","m","defaultProps","ref","l","opacity","closed","Border","AppStage","rectRef","useRef","x1","y1","x2","y2","abs","onMouseDown","stage","KonvaStage","KonvaLine","getLayerXY","onMouseMove","onMouseUp","useStore","evt","clientX","clientY","currentTarget","attrs","container","getBoundingClientRect","Artboard","stageRef","typeSeatOrComplex","typeCorner","dispatchVisible","useEffect","Dropzone","onDragOver","preventDefault","dropImage","dropzone","Element","layerX","layerY","dropWidth","dropHeight","ox2","oy2","setAttrs","nearest","threshold","distances","distance","sqrt","nearestI","reduce","minI","value","getNearestMagnet","cos","SQRT2","sin","onDrop","onDragLeave","deg2rad","PI","styled","div","Selector","shift","chevrons","outerWrap","innerWidth","direction","outerWidth","displayed","floor","nextShift","handleDragStart","getAttribute","dataTransfer","setDragImage","emptyImage","setEmptyDragImage","handleDragEnd","Carousel","LeftChevron","alt","OuterWrap","InnerWrap","Figure","RightChevron","props","figure","App","ReactDOM","getElementById"],"mappings":"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","file":"static/js/main.d761365c.chunk.js","sourcesContent":["export enum FurnitureType {\n    Seat,\n    LeftCorner,\n    RightCorner,\n    Complex,\n}\n\ninterface FurnitureConfig {\n    file: string;\n    size: number[];\n    type: FurnitureType;\n    code: string;\n    price: number;\n    name: string;\n    parts: number[];\n    offset?: number[];\n}\n\nexport const config: {\n    ppmArtboard: number;\n    ppmSelector: number;\n    width: number;\n    height: number;\n    gridStep: number;\n    padding: number;\n    furniture: FurnitureConfig[];\n} = {\n    ppmArtboard: 100,\n    ppmSelector: 40,\n    width: 8.0,\n    height: 6.0,\n    gridStep: 0.2,\n    padding: 0.37,\n    furniture: [\n        {\n            file: \"BS1.png\",\n            size: [0.8, 0.8],\n            type: FurnitureType.Seat,\n            code: \"BS1-A\",\n            price: 799,\n            name: \"(0.8x0.8m)\",\n            parts: [0],\n        },\n        {\n            file: \"BS2.png\",\n            size: [1.6, 0.8],\n            type: FurnitureType.Seat,\n            code: \"BS2-A\",\n            price: 1329,\n            name: \"(1.6x0.8m)\",\n            parts: [1],\n        },\n        {\n            file: \"BS3.png\",\n            size: [2.4, 0.8],\n            type: FurnitureType.Seat,\n            code: \"BS3-A\",\n            price: 1869,\n            name: \"(2.4x0.8m)\",\n            parts: [2],\n        },\n        {\n            file: \"BA1.png\",\n            size: [0.93, 0.93],\n            type: FurnitureType.LeftCorner,\n            code: \"BA1-A\",\n            price: 899,\n            name: \"(0.8x0.8m)\",\n            parts: [3],\n        },\n        {\n            file: \"BA2-L.png\",\n            size: [1.76, 0.93],\n            type: FurnitureType.LeftCorner,\n            code: \"BA2L-A\",\n            price: 1269,\n            name: \"(1.6x0.8m)\",\n            parts: [4],\n        },\n        {\n            file: \"BA2-R.png\",\n            size: [1.76, 0.93],\n            type: FurnitureType.RightCorner,\n            code: \"BA2R-A\",\n            price: 1269,\n            name: \"(1.6x0.8m)\",\n            parts: [5],\n        },\n        {\n            file: \"BS1+BA1.png\",\n            size: [0.93, 0.93],\n            type: FurnitureType.Complex,\n            code: \"BS1+BA1\",\n            price: 1698,\n            name: \"(0.8x0.8m)\",\n            parts: [0, 3],\n            offset: [-0.1, -0.11, 0, 0],\n        },\n        {\n            file: \"BS2+BA1.png\",\n            size: [1.7, 0.93],\n            type: FurnitureType.Complex,\n            code: \"BS2+BA1\",\n            price: 2228,\n            name: \"(1.6x0.8m)\",\n            parts: [1, 3],\n            offset: [0, -0.13, -0.1, 0],\n        },\n        {\n            file: \"BS2+BA2L.png\",\n            size: [1.76, 0.93],\n            type: FurnitureType.Complex,\n            code: \"BS2+BA2L\",\n            price: 2598,\n            name: \"(1.6x0.8m)\",\n            parts: [1, 4],\n            offset: [-0.05, -0.13, -0.11, 0],\n        },\n        {\n            file: \"BS2+BA2R.png\",\n            size: [1.76, 0.93],\n            type: FurnitureType.Complex,\n            code: \"BS2+BA2R\",\n            price: 2598,\n            name: \"(1.6x0.8m)\",\n            parts: [1, 5],\n            offset: [-0.1, -0.13, -0.06, 0],\n        },\n        {\n            file: \"BS2+BA1+BA1.png\",\n            size: [1.86, 0.93],\n            type: FurnitureType.Complex,\n            code: \"BS2+BA1+BA1\",\n            price: 3127,\n            name: \"(1.6x0.8m)\",\n            parts: [1, 3, 3],\n            offset: [-0.12, -0.11, -0.14, -0.02],\n        },\n        {\n            file: \"BS2+BS2+BA2L.png\",\n            size: [2.55, 1.76],\n            type: FurnitureType.Complex,\n            code: \"BS2+BS2+BA2L\",\n            price: 3927,\n            name: \"(2.4x1.6m)\",\n            parts: [1, 1, 4],\n            offset: [0.01, -0.14, -0.16, -0.02],\n        },\n        {\n            file: \"BS2+BS2+BA2R.png\",\n            size: [2.55, 1.76],\n            type: FurnitureType.Complex,\n            code: \"BS2+BS2+BA2R\",\n            price: 3927,\n            name: \"(2.4x1.6m)\",\n            parts: [1, 1, 5],\n            offset: [-0.16, -0.15, 0, 0],\n        },\n        {\n            file: \"BS3+BA1.png\",\n            size: [2.55, 0.93],\n            type: FurnitureType.Complex,\n            code: \"BS3+BA1\",\n            price: 2768,\n            name: \"(2.4x0.8m)\",\n            parts: [2, 3],\n            offset: [-0.14, -0.12, 0, 0],\n        },\n        {\n            file: \"BS3+BA1+BA2R.png\",\n            size: [2.68, 0.93],\n            type: FurnitureType.Complex,\n            code: \"BS3+BA1+BA2R\",\n            price: 4037,\n            name: \"(2.4x0.8m)\",\n            parts: [2, 3, 5],\n            offset: [-0.14, -0.12, -0.14, 0],\n        },\n        {\n            file: \"BS3+BA1_flip.png\",\n            size: [2.55, 0.93],\n            type: FurnitureType.Complex,\n            code: \"BS3+BA1\",\n            price: 2768,\n            name: \"(2.4x0.8m)\",\n            parts: [2, 3],\n            offset: [0, -0.12, -0.15, 0],\n        },\n        {\n            file: \"BS3+BA2L.png\",\n            size: [2.55, 0.93],\n            type: FurnitureType.Complex,\n            code: \"BS3+BA2L\",\n            price: 3138,\n            name: \"(2.4x0.8m)\",\n            parts: [2, 4],\n            offset: [0, -0.12, -0.15, 0],\n        },\n        {\n            file: \"BS3+BA2R.png\",\n            size: [2.55, 0.93],\n            type: FurnitureType.Complex,\n            code: \"BS3+BA2R\",\n            price: 3138,\n            name: \"(2.4x0.8m)\",\n            parts: [2, 5],\n            offset: [-0.14, -0.12, 0, 0],\n        },\n    ],\n};\n","import { config } from \"../config\";\nimport { createSlice, PayloadAction, current } from \"@reduxjs/toolkit\";\nimport { RootState } from \"../store\";\nimport { IRect } from \"konva/lib/types\";\nimport { FurnitureType } from \"../config\";\nimport { Util } from \"konva/lib/Util\";\n\n// config to furniture\nconst toPixel = (x: number) => x * config.ppmArtboard;\nconst furniture = config.furniture.map((furnitureConfig) => {\n    const { size, file, offset } = furnitureConfig;\n    const width = toPixel(size[0]);\n    const height = toPixel(size[1]);\n    const image = new Image();\n    image.width = width;\n    image.height = height;\n    image.src = `${process.env.PUBLIC_URL}/images/${file}`;\n    return {\n        ...furnitureConfig,\n        image,\n        width,\n        height,\n        selectorWidth: size[0] * config.ppmSelector,\n        selectorHeight: size[1] * config.ppmSelector,\n        offset: (offset ?? [0, 0, 0, 0]).map(toPixel),\n    };\n});\n\n// config to artboard\nconst width = toPixel(config.width);\nconst height = toPixel(config.height);\nconst gridStep = toPixel(config.gridStep);\nconst padding = toPixel(config.padding);\nconst round = (x: number) => Math.round((x - padding) / gridStep) * gridStep + padding;\nconst artboard = { width, height, gridStep, padding, round };\n\n// slice\nexport interface Placement {\n    id: number;\n    x: number;\n    y: number;\n    rotation: number;\n    selected: boolean;\n    rect: IRect;\n    offset: number[];\n    type: FurnitureType;\n}\nexport interface Magnet {\n    x: number;\n    y: number;\n    rotation: number;\n}\nconst slice = createSlice({\n    name: \"artboard\",\n    initialState: {\n        placement: [] as Placement[],\n        drop: {\n            id: 0,\n            visible: false,\n            type: FurnitureType.Seat,\n        },\n        stageRect: { x: 0, y: 0, width: 0, height: 0 } as IRect,\n        magnets: [] as Magnet[],\n    },\n    reducers: {\n        place: (state, action: PayloadAction<{ id: number; x: number; y: number; rotation?: number }>) => {\n            const { id, x, y, rotation } = action.payload;\n            const { width, height, type, offset } = furniture[id];\n            const [ox1, oy1, ox2, oy2] = offset;\n            const r = ((rotation ?? 0) + 360) % 360;\n            const rect = { x: x - ox1, y: y - oy1, width: width + ox1 + ox2, height: height + oy1 + oy2 };\n            if (r === 90) {\n                rect.x -= height;\n                rect.width += height - width;\n                rect.height += width - height;\n            } else if (r === 180) {\n                rect.y -= height;\n                rect.x -= width;\n            } else if (r === 270) {\n                rect.y -= width;\n                rect.width += height - width;\n                rect.height += width - height;\n            }\n            state.placement.push({\n                id,\n                x: x - ox1,\n                y: y - oy1,\n                rotation: r,\n                selected: false,\n                rect,\n                offset,\n                type,\n            });\n        },\n        move: (state, action: PayloadAction<{ selected: number[]; movementX: number; movementY: number }>) => {\n            const { placement } = state;\n            const { selected, movementX, movementY } = action.payload;\n            const notCornerId = selected.find((id) => {\n                const type = placement[id].type;\n                return type === FurnitureType.Seat || type === FurnitureType.Complex;\n            });\n            if (notCornerId === undefined) return state;\n            const { x, y } = placement[notCornerId].rect;\n            const dx = round(x + movementX) - x;\n            const dy = round(y + movementY) - y;\n            selected.forEach((id) => {\n                const p = placement[id];\n                p.x += dx;\n                p.y += dy;\n                p.rect.x += dx;\n                p.rect.y += dy;\n            });\n        },\n        rotate: (\n            state,\n            action: PayloadAction<{ selected: number[]; groupRect: { x: number; y: number; height: number } }>\n        ) => {\n            const { placement } = state;\n            const { selected, groupRect } = action.payload;\n            const { x: gx, y: gy, height: gh } = groupRect;\n            selected.forEach((id) => {\n                const p = placement[id];\n                const {\n                    rotation,\n                    rect,\n                    offset: [ox1, oy1],\n                } = current(p);\n                const { x: rx, y: ry, height: rh, width: rw } = rect;\n                const dx = gx + gy + gh - rx - ry - rh;\n                const dy = -gx + gy + rx - ry;\n                p.rect.x += dx;\n                p.rect.y += dy;\n                p.rect.height = rw;\n                p.rect.width = rh;\n                p.rotation = (p.rotation + 90) % 360;\n                if (rotation === 0) {\n                    p.x = p.rect.x + rh - ox1 - oy1;\n                    p.y = p.rect.y - oy1 + ox1;\n                } else if (rotation === 90) {\n                    p.x = p.rect.x + rh - ox1 - ox1;\n                    p.y = p.rect.y + rw - oy1 - oy1;\n                } else if (rotation === 180) {\n                    p.x = p.rect.x - ox1 + oy1;\n                    p.y = p.rect.y + rw - oy1 - ox1;\n                } else {\n                    p.x = p.rect.x;\n                    p.y = p.rect.y;\n                }\n            });\n        },\n        setSelected: (state, action: PayloadAction<number[]>) => {\n            const placement = current(state.placement);\n            const allIds = placement.map((p, i) => i);\n            const conflict = (id1: number, id2: number) => {\n                const t = 4;\n                const crop = ({ x, y, width, height }: IRect) => ({\n                    x: x + t,\n                    y: y + t,\n                    width: width - 2 * t,\n                    height: height - 2 * t,\n                });\n                return Util.haveIntersection(crop(placement[id1].rect), crop(placement[id2].rect));\n            };\n            const attached = (id1: number) => allIds.filter((id2) => conflict(id1, id2));\n            const unique = (xs: number[]) => Array.from(new Set(xs));\n            const add = (ids: number[]): number[] => {\n                const result = unique(ids.flatMap(attached));\n                return result.length === ids.length ? result : add(result);\n            };\n            const selected = add(action.payload);\n            for (let id = 0; id < placement.length; id++) {\n                state.placement[id].selected = selected.includes(id);\n            }\n        },\n        setStageRect: (state, action: PayloadAction<IRect>) => {\n            state.stageRect = action.payload;\n        },\n        setDrop: (state, action: PayloadAction<{ id?: number; visible?: boolean }>) => {\n            const { id, visible } = action.payload;\n            if (id !== undefined) {\n                state.drop.id = id;\n                state.drop.type = furniture[id].type;\n            }\n            if (visible !== undefined) state.drop.visible = visible;\n        },\n        addMagnets: (state) => {\n            const seats = state.placement.filter((p) => p.type === FurnitureType.Seat);\n            seats.forEach((seat) => {\n                const { x, y, width, height } = seat.rect;\n                state.magnets.push(\n                    { x, y, rotation: 0 },\n                    { x: x + width, y, rotation: 90 },\n                    { x: x + width, y: y + height, rotation: 180 },\n                    { x, y: y + height, rotation: 270 }\n                );\n            });\n        },\n        removeMagnets: (state) => {\n            state.magnets = [];\n        },\n    },\n});\n\n// actions\nexport const { place, move, rotate, setSelected, setStageRect, setDrop, addMagnets, removeMagnets } = slice.actions;\n// selectors\nexport const selectFurniture = (state: RootState) => furniture;\nexport const selectArtboard = (state: RootState) => artboard;\nexport const selectPlacement = (state: RootState) => state.artboard.placement;\nexport const selectStageRect = (state: RootState) => state.artboard.stageRect;\nexport const selectDrop = (state: RootState) => {\n    const crop = ({ x, y, width, height }: IRect, t = 4) => ({\n        x: x + t,\n        y: y + t,\n        width: width - 2 * t,\n        height: height - 2 * t,\n    });\n    const { placement, drop } = state.artboard;\n    const conflict = (rect1: IRect, rect2: IRect) => Util.haveIntersection(crop(rect1), crop(rect2));\n    const { width, height } = furniture[drop.id];\n    const possible = (x: number, y: number) => placement.every((p) => !conflict(p.rect, { x, y, width, height }));\n    return { ...state.artboard.drop, possible };\n};\nexport const selectMagnets = (state: RootState) => state.artboard.magnets;\n// reducer\nexport const artboardReducer = slice.reducer;\n","import { TypedUseSelectorHook, useDispatch, useSelector } from \"react-redux\";\nimport { configureStore } from \"@reduxjs/toolkit\";\nimport { artboardReducer } from \"./slices/artboard\";\n\nexport const store = configureStore({\n    reducer: {\n        artboard: artboardReducer,\n    },\n});\n\nexport type AppDispatch = typeof store.dispatch;\nexport type RootState = ReturnType<typeof store.getState>;\nexport const useAppDispatch = () => useDispatch<AppDispatch>();\nexport const useAppSelector: TypedUseSelectorHook<RootState> = useSelector;\n","import { LineConfig } from \"konva/lib/shapes/Line\";\nimport { Line } from \"react-konva\";\nimport { selectArtboard } from \"../slices/artboard\";\nimport { useAppSelector } from \"../store\";\n\nconst darkGrey = \"#999999\";\nconst lightGrey = \"#cccccc\";\n\nexport function Grid() {\n    const { width, height, gridStep, padding: p } = useAppSelector(selectArtboard);\n    const lines: LineConfig[] = [];\n    let key = 0;\n    let stroke = lightGrey;\n    const vertical = (x: number) => <Line key={key} stroke={stroke} x={x} y={p} points={[0, -1, 0, height + 1]} />;\n    const horizontal = (y: number) => <Line key={key} stroke={stroke} x={p} y={y} points={[-1, 0, width + 1, 0]} />;\n    for (let x = p; x <= width + p; key += 1, x += gridStep) lines.push(vertical(x));\n    for (let y = p; y <= height + p; key += 1, y += gridStep) lines.push(horizontal(y));\n    stroke = darkGrey;\n    for (let x = p; x <= width + p; key += 1, x += gridStep * 5) lines.push(vertical(x));\n    for (let y = p; y <= height + p; key += 1, y += gridStep * 5) lines.push(horizontal(y));\n    return <>{lines}</>;\n}\n","import { useState } from \"react\";\nimport { Circle, Group, Image } from \"react-konva\";\n\nconst rotationIcon = document.createElement(\"img\");\nrotationIcon.src = `${process.env.PUBLIC_URL}/images/icons/rotate.svg`;\n\nexport function Menu({ x, y, onRotate }: { x: number; y: number; onRotate: () => void }) {\n    const size = 30;\n    const [state, setState] = useState({ hover: false });\n    const { hover } = state;\n\n    return (\n        <Group\n            onClick={onRotate}\n            onMouseEnter={() => setState({ hover: true })}\n            onMouseLeave={() => setState({ hover: false })}\n        >\n            <Circle\n                x={x - (size * 3) / 4}\n                y={y + size / 2}\n                radius={size / 2}\n                stroke={hover ? \"#f5f5f5\" : \"black\"}\n                strokeWidth={1}\n                fill={hover ? \"#f5f5f5\" : \"white\"}\n            />\n            <Image x={x - size * 1.15} y={y + size * 0.1} image={rotationIcon} width={size * 0.8} height={size * 0.8} />\n        </Group>\n    );\n}\n","import {\n    move,\n    rotate,\n    setSelected,\n    selectPlacement,\n    selectFurniture,\n    selectStageRect,\n    selectArtboard,\n} from \"../slices/artboard\";\nimport { Group, Image, Rect } from \"react-konva\";\nimport { KonvaEventObject } from \"konva/lib/Node\";\nimport { useAppSelector } from \"../store\";\nimport { useDispatch } from \"react-redux\";\nimport { useState } from \"react\";\nimport { Vector2d } from \"konva/lib/types\";\nimport { Menu } from \"./Menu\";\nimport { Placement as PlacementType } from \"../slices/artboard\";\nimport { FurnitureType } from \"../config\";\n\ntype KEO = KonvaEventObject<globalThis.DragEvent>;\n\nexport function Placement({ rectMode }: { rectMode: boolean }) {\n    const dispatch = useDispatch();\n    const { padding, round } = useAppSelector(selectArtboard);\n    const furniture = useAppSelector(selectFurniture);\n    const placement = useAppSelector(selectPlacement);\n    const stageRect = useAppSelector(selectStageRect);\n    const [start, setStart] = useState({ x: 0, y: 0 });\n    const grouped = placement.filter((p) => p.selected);\n    const selected: number[] = [];\n    placement.forEach((p, i) => {\n        if (p.selected) selected.push(i);\n    });\n    const groupRect = getGroupRect(grouped, round);\n    const groupWidth = groupRect.width;\n    const groupHeight = groupRect.height;\n    const xRange = [\n        stageRect.x + padding - groupRect.x,\n        stageRect.x + stageRect.width - groupWidth - padding - groupRect.x,\n    ];\n    const yRange = [padding - groupRect.y, stageRect.height - groupHeight - padding - groupRect.y];\n    const dragBoundFunc = (pos: Vector2d) => {\n        return {\n            x: toRange(pos.x, xRange),\n            y: toRange(pos.y, yRange),\n        };\n    };\n    const onDragStart = (e: KEO) => {\n        const { x, y } = e.target.getClientRect();\n        setStart({ x, y });\n    };\n    const onDragEnd = (e: KEO) => {\n        const { x, y } = e.target.getClientRect();\n        dispatch(move({ selected, movementX: x - start.x, movementY: y - start.y }));\n        dispatch(setSelected([]));\n        dispatch(setSelected(selected));\n    };\n    const onRotate = () => {\n        dispatch(rotate({ selected, groupRect }));\n    };\n    const onMouseEnter = (id: number) => (e: KEO) => {\n        if (rectMode) return;\n        dispatch(setSelected([id]));\n    };\n    return (\n        <>\n            {/* {placement.map(({ rect: { x, y, width, height } }, key) => {\n                return <Rect stroke=\"cyan\" {...{ x, y, width, height, key }} />;\n            })} */}\n            {placement.map(({ id, x, y, rotation, selected }, key) => {\n                if (selected && !rectMode) return null;\n                const offset = furniture[id].offset;\n                return (\n                    <Image\n                        {...{ key, x: x + offset[0], y: y + offset[1], rotation }}\n                        image={furniture[id].image}\n                        onMouseEnter={onMouseEnter(key)}\n                    />\n                );\n            })}\n            {grouped.length > 0 && !rectMode && (\n                <Group draggable {...{ onDragStart, onDragEnd, dragBoundFunc }}>\n                    {grouped.map(({ id, x, y, rotation }, key) => {\n                        const offset = furniture[id].offset;\n                        return (\n                            <Image\n                                {...{ key, x: x + offset[0], y: y + offset[1], rotation }}\n                                image={furniture[id].image}\n                            />\n                        );\n                    })}\n                    {groupRect.visible && <Rect {...groupRect} stroke=\"black\" />}\n                    <Menu x={groupRect.x} y={groupRect.y} onRotate={onRotate} />\n                </Group>\n            )}\n        </>\n    );\n}\n\nfunction toRange(x: number, [min, max]: number[]) {\n    if (x < min) return min;\n    if (x > max) return max;\n    return x;\n}\n\nfunction getGroupRect(grouped: PlacementType[], round: (x: number) => number) {\n    let xMin = Infinity;\n    let yMin = Infinity;\n    let xMax = -Infinity;\n    let yMax = -Infinity;\n    const noCorner = (p: PlacementType) => p.type === FurnitureType.Seat || p.type === FurnitureType.Complex;\n    for (const p of grouped.filter(noCorner)) {\n        const { x, y, width, height } = p.rect;\n        if (x < xMin) xMin = x;\n        if (y < yMin) yMin = y;\n        if (x + width > xMax) xMax = x + width;\n        if (y + height > yMax) yMax = y + height;\n    }\n    const x = round(xMin);\n    const y = round(yMin);\n    return {\n        x,\n        y,\n        width: round(xMax) - x,\n        height: round(yMax) - y,\n        visible: grouped.length > 0,\n    };\n}\n","import { Image as KonvaImage } from \"konva/lib/shapes/Image\";\nimport { Image, Line } from \"react-konva\";\nimport { useAppSelector } from \"../store\";\nimport { selectFurniture, selectDrop, selectMagnets } from \"../slices/artboard\";\n\nexport function DropShadow({ dropRef }: { dropRef: React.RefObject<KonvaImage> }) {\n    const { id, visible } = useAppSelector(selectDrop);\n    const furniture = useAppSelector(selectFurniture);\n    const magnets = useAppSelector(selectMagnets);\n    if (!visible) return null;\n    const image = furniture[id].image;\n    return (\n        <>\n            {magnets.map((m, key) => (\n                <Line {...defaultProps} {...m} key={key} />\n            ))}\n            <Image ref={dropRef} y={-200} image={image} />\n        </>\n    );\n}\n\nconst l = 36;\nconst defaultProps = {\n    points: [0, 0, l, 0, l, l / 2, l * 0.5, l / 2, l * 0.5, l, 0, l],\n    fill: \"#00FF00\",\n    opacity: 0.5,\n    strokeWidth: 0,\n    closed: true,\n};\n","import { Line } from \"react-konva\";\nimport { selectArtboard, selectDrop } from \"../slices/artboard\";\nimport { useAppSelector } from \"../store\";\n\nexport function Border() {\n    const drop = useAppSelector(selectDrop);\n    const { width, height, padding: p } = useAppSelector(selectArtboard);\n    if (!drop.visible) return null;\n    return (\n        <>\n            <Line x={p} y={p} stroke=\"black\" points={[0, -1, 0, height + 1]} />\n            <Line x={p} y={p} stroke=\"black\" points={[-1, 0, width, 0]} />\n            <Line x={p} y={p + height} stroke=\"black\" points={[-1, 0, width, 0]} />\n            <Line x={p + width} y={p} stroke=\"black\" points={[0, -1, 0, height + 1]} />\n        </>\n    );\n}\n","import { useRef, useState } from \"react\";\nimport { Stage, Layer, Rect } from \"react-konva\";\nimport { Provider, useStore } from \"react-redux\";\nimport { Grid } from \"./Grid\";\nimport { Placement } from \"./Placement\";\nimport { DropShadow } from \"./DropShadow\";\nimport { Border } from \"./Border\";\nimport { Util } from \"konva/lib/Util\";\nimport { Image as KonvaImage } from \"konva/lib/shapes/Image\";\nimport { Rect as KonvaRect } from \"konva/lib/shapes/Rect\";\nimport { Line as KonvaLine } from \"konva/lib/shapes/Line\";\nimport { Stage as KonvaStage } from \"konva/lib/Stage\";\nimport { KonvaEventObject } from \"konva/lib/Node\";\nimport { useAppDispatch, useAppSelector } from \"../store\";\nimport { selectArtboard, selectPlacement, setSelected } from \"../slices/artboard\";\n\nexport function AppStage({ dropRef }: { dropRef: React.RefObject<KonvaImage> }) {\n    const dispatch = useAppDispatch();\n    const rectRef = useRef<KonvaRect>(null);\n    const placement = useAppSelector(selectPlacement);\n    const initialState = { x1: 0, y1: 0, x2: 0, y2: 0, rectMode: false };\n    const [{ x1, y1, x2, y2, rectMode }, setState] = useState(initialState);\n    const rect = { x: Math.min(x1, x2), y: Math.min(y1, y2), width: Math.abs(x2 - x1), height: Math.abs(y2 - y1) };\n    const { width, height, padding } = useAppSelector(selectArtboard);\n    const onMouseDown = (e: KonvaEventObject<MouseEvent>) => {\n        const stage = e.target;\n        if (!(stage instanceof KonvaStage || stage instanceof KonvaLine)) return;\n        const { x, y } = getLayerXY(e);\n        setState({ x1: x, y1: y, x2: x, y2: y, rectMode: true });\n        dispatch(setSelected([]));\n    };\n    const onMouseMove = (e: KonvaEventObject<MouseEvent>) => {\n        if (!rectMode) return;\n        const { x, y } = getLayerXY(e);\n        setState({ x1, y1, x2: x, y2: y, rectMode: true });\n    };\n    const onMouseUp = (e: KonvaEventObject<MouseEvent>) => {\n        if (!rectMode) return;\n        const selected: number[] = [];\n        placement.forEach((p, i) => {\n            if (Util.haveIntersection(rect, p.rect)) selected.push(i);\n        });\n        dispatch(setSelected(selected));\n        setState(initialState);\n    };\n\n    return (\n        <Stage {...{ onMouseDown, onMouseMove, onMouseUp }} width={width + 2 * padding} height={height + 2 * padding}>\n            <Provider store={useStore()}>\n                <Layer>\n                    <Grid />\n                    <Border />\n                    <Placement rectMode={rectMode} />\n                    <DropShadow dropRef={dropRef} />\n                    <Rect {...rect} ref={rectRef} fill=\"rgba(0,0,255,0.5)\" visible={rectMode} />\n                </Layer>\n            </Provider>\n        </Stage>\n    );\n}\n\nfunction getLayerXY(e: KonvaEventObject<MouseEvent>) {\n    const { clientX, clientY } = e.evt;\n    const { x, y } = e.currentTarget.attrs.container.getBoundingClientRect();\n    return {\n        x: clientX - x,\n        y: clientY - y,\n    };\n}\n","import { Image as KonvaImage } from \"konva/lib/shapes/Image\";\nimport { useAppDispatch, useAppSelector } from \"../store\";\nimport {\n    place,\n    setDrop,\n    selectArtboard,\n    selectFurniture,\n    selectDrop,\n    setStageRect,\n    selectStageRect,\n    selectMagnets,\n    Magnet,\n} from \"../slices/artboard\";\nimport { DragEventHandler, useEffect, useRef } from \"react\";\nimport styled from \"styled-components\";\nimport { AppStage } from \"./AppStage\";\nimport { FurnitureType } from \"../config\";\n\nexport function Artboard() {\n    const dispatch = useAppDispatch();\n    const { round, padding } = useAppSelector(selectArtboard);\n    const stageRef = useRef<HTMLDivElement>(null);\n    const stageRect = useAppSelector(selectStageRect);\n    const drop = useAppSelector(selectDrop);\n    const { type } = drop;\n    const typeSeatOrComplex = type === FurnitureType.Seat || type === FurnitureType.Complex;\n    const typeCorner = type === FurnitureType.LeftCorner || type === FurnitureType.RightCorner;\n    const furniture = useAppSelector(selectFurniture);\n    const dropRef = useRef<KonvaImage>(null);\n    const magnets = useAppSelector(selectMagnets);\n    const dispatchVisible = (visible: boolean) => {\n        if (drop.visible !== visible) dispatch(setDrop({ visible }));\n    };\n    useEffect(() => {\n        if (stageRef.current === null) return;\n        const { x, y, width, height } = stageRef.current.getBoundingClientRect();\n        if (stageRect.x === x && stageRect.width === width) return;\n        dispatch(setStageRect({ x, y, width, height }));\n    });\n    const onDragOver: DragEventHandler = (e) => {\n        e.preventDefault();\n        const dropImage = dropRef.current;\n        const dropzone = e.target;\n        if (dropImage === null || !(dropzone instanceof Element)) {\n            dispatchVisible(true);\n            return;\n        }\n        const { x, y, width, height } = dropzone.getBoundingClientRect();\n        const layerX = e.clientX - x;\n        const layerY = e.clientY - y;\n        const dropWidth = furniture[drop.id].width;\n        const dropHeight = furniture[drop.id].height;\n        if (typeSeatOrComplex) {\n            const { offset } = furniture[drop.id];\n            const [ox1, oy1, ox2, oy2] = offset;\n            // mutate ref object\n            const x = round(toRange(layerX, [padding, width - padding - dropWidth - ox1 - ox2])) + ox1;\n            const y = round(toRange(layerY, [padding, height - padding - dropHeight - oy1 - oy2])) + oy1;\n            dropImage.setAttrs({\n                x,\n                y,\n                visible: true,\n                opacity: 0.7,\n                fill: drop.possible(x, y) ? undefined : \"rgb(255,0,0,0.5)\",\n            });\n            return;\n        }\n        const nearest = getNearestMagnet(layerX, layerY, magnets);\n        if (nearest === undefined) {\n            // mutate ref object\n            dropImage.setAttrs({ visible: false });\n            return;\n        }\n        if (type === FurnitureType.LeftCorner) {\n            const { x, y, rotation } = nearest;\n            // mutate ref object\n            dropImage.setAttrs({\n                x: x + cos(rotation - 135) * 12 * Math.SQRT2,\n                y: y + sin(rotation - 135) * 12 * Math.SQRT2,\n                visible: true,\n                rotation,\n            });\n            return;\n        }\n        if (type === FurnitureType.RightCorner) {\n            const { x, y, rotation } = nearest;\n            // mutate ref object\n            dropImage.setAttrs({\n                x: x + cos(rotation - 135) * 12 * Math.SQRT2 + sin(-rotation) * dropWidth,\n                y: y + sin(rotation - 135) * 12 * Math.SQRT2 + cos(-rotation) * dropWidth,\n                visible: true,\n                rotation: rotation - 90,\n            });\n            return;\n        }\n    };\n    const onDragLeave: DragEventHandler = (e) => {\n        dispatchVisible(false);\n    };\n    const onDrop: DragEventHandler = (e) => {\n        e.preventDefault();\n        const dropImage = dropRef.current;\n        if (dropImage === null) return;\n        const { x, y, rotation, visible } = dropImage.attrs;\n        if ((typeSeatOrComplex && drop.possible(x, y)) || (typeCorner && visible)) {\n            dispatch(place({ id: drop.id, x, y, rotation }));\n        }\n    };\n    return (\n        <Dropzone ref={stageRef} onDragOver={onDragOver} onDrop={onDrop} onDragLeave={onDragLeave}>\n            <AppStage dropRef={dropRef} />\n        </Dropzone>\n    );\n}\n\nfunction toRange(x: number, [min, max]: number[]) {\n    if (x < min) return min;\n    if (x > max) return max;\n    return x;\n}\n\nconst deg2rad = Math.PI / 180;\n\nfunction cos(x: number) {\n    return Math.cos(x * deg2rad);\n}\n\nfunction sin(x: number) {\n    return Math.sin(x * deg2rad);\n}\n\nfunction getNearestMagnet(layerX: number, layerY: number, magnets: Magnet[]): Magnet | undefined {\n    const threshold = 100;\n    const distances = magnets.map((m) => {\n        const dx = layerX - m.x;\n        const dy = layerY - m.y;\n        const distance = Math.sqrt(dx * dx + dy * dy);\n        return distance < threshold ? distance : Infinity;\n    });\n    const nearestI = distances.reduce((minI, value, i): number => (distances[minI] > value ? i : minI), 0);\n    return distances[nearestI] === Infinity ? undefined : magnets[nearestI];\n}\nconst Dropzone = styled.div`\n    display: table;\n`;\n","import { useState, useRef, DragEventHandler, DragEvent } from \"react\";\nimport styled from \"styled-components\";\nimport { useAppDispatch, useAppSelector } from \"../store\";\nimport { selectFurniture, setDrop, addMagnets, removeMagnets, setSelected } from \"../slices/artboard\";\nimport { FurnitureType } from \"../config\";\n\nexport function Selector() {\n    // state\n    const [state, setState] = useState({\n        shift: 0,\n        chevrons: [false, true],\n    });\n    const size = 143;\n    const furniture = useAppSelector(selectFurniture);\n    const outerWrap = useRef<HTMLDivElement>(null);\n    const innerWidth = size * furniture.length;\n\n    // events\n    const dispatch = useAppDispatch();\n    const move = (direction: number) => {\n        if (null === outerWrap.current) return;\n        const outerWidth = outerWrap.current.getBoundingClientRect().width;\n        const displayed = Math.floor(outerWidth / size);\n        const min = -innerWidth + displayed * size;\n        let nextShift = state.shift + displayed * size * direction;\n        if (nextShift > 0) nextShift = 0;\n        if (nextShift < min) nextShift = min;\n        setState({ shift: nextShift, chevrons: [nextShift !== 0, nextShift !== min] });\n    };\n    const handleDragStart: DragEventHandler = (e) => {\n        const { target } = e;\n        if (!(target instanceof Element)) return;\n        const id = target.getAttribute(\"data-furniture-id\");\n        if (id === null) return;\n        setEmptyDragImage(e);\n        dispatch(setDrop({ id: +id }));\n        dispatch(setSelected([]));\n        const type = furniture[+id].type;\n        if (type === FurnitureType.LeftCorner || type === FurnitureType.RightCorner) {\n            dispatch(addMagnets());\n        }\n    };\n    const handleDragEnd: DragEventHandler = (e) => {\n        dispatch(setDrop({ visible: false }));\n        dispatch(removeMagnets());\n    };\n    return (\n        <Carousel>\n            <LeftChevron visible={state.chevrons[0]}>\n                <img src={`${process.env.PUBLIC_URL}/images/icons/arrow.svg`} alt=\"left\" onClick={() => move(1)} />\n            </LeftChevron>\n            <OuterWrap ref={outerWrap}>\n                <InnerWrap width={innerWidth} shift={state.shift}>\n                    {furniture.map(({ file, name, code, price, selectorWidth }, i) => (\n                        <Figure\n                            key={i}\n                            draggable=\"true\"\n                            onDragStart={handleDragStart}\n                            onDragEnd={handleDragEnd}\n                            data-furniture-id={i}\n                        >\n                            <img src={`${process.env.PUBLIC_URL}/images/${file}`} alt={name} width={selectorWidth} data-furniture-id={i} />\n                            <figcaption>\n                                {name} <br /> {code} <br /> {price} EUR{\" \"}\n                            </figcaption>\n                        </Figure>\n                    ))}\n                </InnerWrap>\n            </OuterWrap>\n            <RightChevron visible={state.chevrons[1]}>\n                <img src={`${process.env.PUBLIC_URL}/images/icons/arrow.svg`} alt=\"right\" onClick={() => move(-1)} />\n            </RightChevron>\n        </Carousel>\n    );\n}\n\nconst emptyImage = new Image();\nemptyImage.src = \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\";\nfunction setEmptyDragImage(e: DragEvent) {\n    e.dataTransfer.setDragImage(emptyImage, 0, 0);\n}\n\nconst Carousel = styled.div`\n    display: flex;\n`;\n\nconst LeftChevron = styled.div<{ visible: boolean }>`\n    transform: rotate(180deg);\n    align-self: center;\n    opacity: ${(props) => (props.visible ? 1 : 0)};\n`;\n\nconst RightChevron = styled(LeftChevron)`\n    transform: none;\n`;\n\nconst OuterWrap = styled.div`\n    margin: 0 5px;\n    overflow: hidden;\n`;\n\nconst InnerWrap = styled.div<{ width: number; shift: number }>`\n    transition: transform 1s;\n    margin: 20px -15px;\n    width: ${(props) => props.width}px;\n    transform: translateX(${(props) => props.shift}px);\n`;\n\nconst Figure = styled.figure`\n    display: block;\n    position: relative;\n    width: 113px;\n    height: 141px;\n    float: left;\n    margin: 0 15px;\n    text-align: center;\n    background-color: #f7f7f7;\n    text-align: left;\n    figcaption {\n        position: absolute;\n        font: 12px AtlasGrotesk-Regular;\n        left: 2px;\n        bottom: 3px;\n    }\n`;\n","import { Artboard } from \"./Artboard\";\nimport { Selector } from \"./Selector\";\n\nexport function App() {\n    return (\n        <>\n            <Selector />\n            <Artboard />\n        </>\n    );\n}\n","import * as React from \"react\";\nimport * as ReactDOM from \"react-dom\";\nimport { App } from \"./components/App\";\nimport { store } from \"./store\";\nimport { Provider } from \"react-redux\";\nimport \"./index.css\";\n\nReactDOM.render(\n    <React.StrictMode>\n        <Provider store={store}>\n            <App />\n        </Provider>\n    </React.StrictMode>,\n    document.getElementById(\"root\")\n);\n"],"sourceRoot":""}